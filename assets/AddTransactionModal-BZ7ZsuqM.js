import{B,r as c,z as V,C as q,j as e,I as y,D as C,y as j,q as z,c as P,x as K}from"./index-DsGEnprn.js";import{z as a,u as O,s as Q,E as h,C as A,B as L}from"./ErrorTextForm-DmANn02H.js";import{F as J}from"./Dashboard-D0Qy5Pfu.js";var W=B();function $({title:t,titleId:s,...o},l){return c.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:l,"aria-labelledby":s},o),t?c.createElement("title",{id:s},t):null,c.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m9.75 9.75 4.5 4.5m0-4.5-4.5 4.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}))}const M=c.forwardRef($),X=a.object({id:a.string(),name:a.string(),color:a.string(),type:a.string()});a.object({id:a.string(),userId:a.string(),title:a.string(),category:X,type:a.enum(["expense","income"]),amount:a.number(),date:a.date()});const Z=a.object({title:a.string().nonempty("Nama transaksi masih kosong"),category:a.object({id:a.string(),name:a.string().nonempty("Pilih satu kategori"),color:a.string()}),amount:a.number().min(1,"Jumlah transaksi masih kosong")}),f=({category:t,field:s,setIsOpen:o})=>e.jsx("li",{id:t.id,className:"cursor-pointer list-none rounded-md px-2 py-1 text-sm text-white transition-all duration-150 hover:scale-95",style:{backgroundColor:`${t.color}`},onClick:()=>{s&&o&&(s.onChange(t),o(!1))},children:t.name}),G=({field:t})=>{const{categories:s}=V(),[o,l]=c.useState(!1),m=c.useRef(null),d=s.filter(n=>n.id===t.value.id)[0];return q(m,()=>l(!1)),e.jsxs("div",{className:"relative w-full",ref:m,children:[e.jsx(y,{readOnly:!0,onFocus:()=>l(!0),className:"relative w-full"}),d&&e.jsx(C,{onClick:()=>{t.onChange({id:"",name:"",color:""}),l(!0)},className:"absolute top-1/2 right-0 mr-1 -translate-y-1/2",icon:e.jsx(J,{className:"size-6 text-rose-400"})}),d&&e.jsx("span",{className:"absolute top-1/2 left-0 ml-2 -translate-y-1/2",children:e.jsx(f,{category:d})}),e.jsxs("div",{className:j("bg-woodsmoke-50 dark:bg-woodsmoke-800 absolute z-30 flex origin-top flex-col gap-2 rounded-md p-2 shadow-md transition-all duration-300",o?"pointer-events-auto translate-y-2 scale-y-100 opacity-100":"pointer-events-none -translate-y-4 scale-y-90 opacity-0"),children:[e.jsxs("div",{children:[e.jsx("span",{children:"Pengeluaran"}),e.jsx("ul",{className:"mt-1 flex flex-wrap gap-2",children:s.map(n=>{if(n.type==="expense")return e.jsx(f,{category:n,field:t,setIsOpen:l},n.id)})})]}),e.jsx("hr",{className:"outline-tradewind border-tradewind outline-1"}),e.jsxs("div",{children:[e.jsx("span",{children:"Pemasukan"}),e.jsx("ul",{className:"mt-1 flex flex-wrap gap-2",children:s.map(n=>{if(n.type==="income")return e.jsx(f,{category:n,field:t,setIsOpen:l},n.id)})})]})]})]})},H=({isOpen:t})=>e.jsx("div",{className:j("bg-woodsmoke-900/30 fixed top-0 left-0 z-50 min-h-screen w-full transition-opacity duration-300",t?"pointer-events-auto opacity-100":"pointer-events-none opacity-0")}),U=t=>t.replace(/\B(?=(\d{3})+(?!\d))/g,"."),ae=({isOpen:t,closeModal:s})=>{var b,v,k;const{register:o,handleSubmit:l,setValue:m,control:d,formState:{isSubmitting:n,errors:i}}=O({resolver:Q(Z),defaultValues:{title:"",amount:0,category:{id:"",name:"",color:""}}}),[S,w]=c.useState(""),u=c.useRef(null),x=z(),T=r=>{const p=r.target.value,E=r.target.selectionStart??0,g=p.replace(/\D/g,"").replace(/\./g,"");if(g===""){w(""),m("amount",0,{shouldValidate:!0});return}const N=U(g),F=(p.match(/\./g)||[]).length,R=(N.match(/\./g)||[]).length-F;w(N),m("amount",parseInt(g),{shouldValidate:!0}),setTimeout(()=>{u.current&&(u.current.selectionStart=u.current.selectionEnd=E+R)},0)},I=async r=>{await K({url:"/transactions",method:"POST",data:r}),x.invalidateQueries({queryKey:["recent-transactions"]}),x.invalidateQueries({queryKey:["summary"]}),x.invalidateQueries({queryKey:["by-category"]}),x.invalidateQueries({queryKey:["this-week"]}),s()},D=r=>{const p={title:r.title,amount:parseInt(r.amount.toString().replace(/\./g,"")),categoryId:r.category.id};I(p)};return W.createPortal(e.jsxs(e.Fragment,{children:[e.jsx(H,{isOpen:t}),e.jsxs("div",{className:j("text-chathams-blue dark:bg-woodsmoke-900 fixed top-1/2 left-1/2 z-50 w-[calc(100%-32px)] max-w-md -translate-x-1/2 rounded-md bg-white p-6 shadow-md transition-all duration-300 md:w-full dark:text-white",t?"pointer-events-auto -translate-y-1/2 opacity-100":"pointer-events-none -translate-y-[calc(50%+16px)] opacity-0"),children:[e.jsxs("div",{className:"flex w-full justify-between",children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"Tambah Transaksi"}),e.jsx(C,{onClick:s,icon:e.jsx(M,{className:"text-rose-400"})})]}),e.jsx("hr",{className:"bg-tradewind-600 mx-auto my-3 h-0.5 w-full border-none outline-none"}),e.jsx("div",{children:e.jsxs("form",{action:"",onSubmit:l(D),className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{htmlFor:"title",className:"text-lg font-semibold",children:"Transaksi"}),e.jsx(y,{id:"title",type:"text",...o("title"),errors:i.title}),i.title&&e.jsx(h,{children:i.title.message})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{htmlFor:"category",className:"text-lg font-semibold",children:"Kategori"}),e.jsx(A,{name:"category",control:d,render:({field:r})=>e.jsx(G,{field:r})}),((v=(b=i.category)==null?void 0:b.name)==null?void 0:v.message)&&e.jsx(h,{children:i.category.name.message})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{htmlFor:"amount",className:"text-lg font-semibold",children:"Jumlah"}),e.jsx(y,{prefixIcon:"Rp",id:"amount",type:"text",...o("amount"),value:S,onChange:T,ref:u,errors:i.amount,autoComplete:"off"}),((k=i.amount)==null?void 0:k.message)&&e.jsx(h,{children:i.amount.message})]}),e.jsx(L,{type:"submit",children:n?e.jsx(P,{}):"Tambah Transaksi"})]})})]})]}),document.getElementById("modal-wrapper"))};export{ae as default};
